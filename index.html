<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Interview Trainer</title>
    <style>
        :root {
            --primary: #6366f1; --secondary: #8b5cf6; --bg-dark: #0f172a; --bg-card: #1e293b;
            --bg-input: #334155; --text-primary: #f1f5f9; --text-secondary: #94a3b8; 
            --accent: #22d3ee; --success: #10b981; --border: #475569;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1f3a 100%);
            color: var(--text-primary); min-height: 100vh; overflow-x: hidden;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header {
            text-align: center; padding: 40px 0;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: fadeIn 0.8s ease;
        }
        .header h1 { font-size: 3rem; font-weight: 800; margin-bottom: 10px; }
        .header p { font-size: 1.2rem; -webkit-text-fill-color: var(--text-secondary); }
        .screen { display: none; animation: slideIn 0.5s ease; }
        .screen.active { display: block; }
        .card {
            background: var(--bg-card); border-radius: 20px; padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); border: 1px solid var(--border);
            backdrop-filter: blur(10px);
        }
        .form-group { margin-bottom: 30px; }
        label {
            display: block; margin-bottom: 10px; color: var(--text-primary);
            font-weight: 600; font-size: 1.1rem;
        }
        textarea, input, select {
            width: 100%; padding: 15px; background: var(--bg-input);
            border: 2px solid var(--border); border-radius: 12px;
            color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease;
        }
        select {
            cursor: pointer; appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat; background-position: right 15px center; background-size: 20px;
            padding-right: 45px;
        }
        textarea:focus, input:focus, select:focus {
            outline: none; border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); transform: translateY(-2px);
        }
        .btn {
            padding: 15px 40px; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 600;
            cursor: pointer; transition: all 0.3s ease; box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(99, 102, 241, 0.4); }
        .btn-secondary { background: var(--bg-input); box-shadow: none; margin-left: 10px; }
        .btn-secondary:hover { background: var(--border); }
        .chat-container {
            background: var(--bg-card); border-radius: 20px; height: 600px; display: flex;
            flex-direction: column; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border); overflow: hidden;
        }
        .chat-header {
            padding: 20px; background: linear-gradient(135deg, var(--bg-input) 0%, var(--bg-card) 100%);
            border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;
        }
        .chat-header h3 { display: flex; align-items: center; gap: 10px; }
        .status-dot {
            width: 10px; height: 10px; background: var(--success); border-radius: 50%;
            animation: pulse 2s infinite;
        }
        .model-badge {
            background: var(--bg-input); padding: 5px 12px; border-radius: 20px;
            font-size: 0.85rem; color: var(--accent); font-weight: 600;
        }
        .chat-messages { flex: 1; overflow-y: auto; padding: 20px; scroll-behavior: smooth; }
        .chat-messages::-webkit-scrollbar { width: 8px; }
        .chat-messages::-webkit-scrollbar-track { background: var(--bg-input); border-radius: 4px; }
        .chat-messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
        .message { margin-bottom: 20px; display: flex; gap: 12px; animation: messageSlide 0.3s ease; }
        .message.user { flex-direction: row-reverse; }
        .message-avatar {
            width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; font-weight: bold; flex-shrink: 0;
        }
        .message.ai .message-avatar { background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); }
        .message.user .message-avatar { background: linear-gradient(135deg, var(--accent) 0%, var(--success) 100%); }
        .message-content {
            max-width: 70%; padding: 15px 20px; border-radius: 18px;
            background: var(--bg-input); position: relative;
        }
        .message.user .message-content { background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); }
        .message-time { font-size: 0.75rem; color: var(--text-secondary); margin-top: 5px; }
        .chat-input-container { padding: 20px; background: var(--bg-input); border-top: 1px solid var(--border); }
        .chat-input-wrapper { display: flex; gap: 10px; }
        .chat-input {
            flex: 1; padding: 12px 20px; background: var(--bg-card); border: 2px solid var(--border);
            border-radius: 25px; color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease;
        }
        .chat-input:focus { outline: none; border-color: var(--primary); }
        .send-btn {
            padding: 12px 30px; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 600;
            transition: all 0.3s ease;
        }
        .send-btn:hover:not(:disabled) { transform: scale(1.05); }
        .send-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .settings-panel {
            position: fixed; top: 0; right: -450px; width: 450px; height: 100%;
            background: var(--bg-card); box-shadow: -10px 0 30px rgba(0, 0, 0, 0.5);
            transition: right 0.3s ease; z-index: 1000; padding: 30px; overflow-y: auto;
        }
        .settings-panel.open { right: 0; }
        .settings-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .close-settings {
            background: transparent; border: none; color: var(--text-secondary);
            font-size: 1.5rem; cursor: pointer; transition: color 0.3s ease;
        }
        .close-settings:hover { color: var(--text-primary); }
        .provider-section {
            background: var(--bg-input); border-radius: 12px; padding: 20px;
            margin-bottom: 20px; border: 1px solid var(--border);
        }
        .provider-section h4 { margin-bottom: 15px; color: var(--accent); font-size: 1.1rem; }
        .model-info {
            background: var(--bg-dark); padding: 10px 15px; border-radius: 8px;
            margin-top: 10px; font-size: 0.9rem; color: var(--text-secondary);
        }
        .typing-indicator { display: none; padding: 20px; align-items: center; gap: 5px; }
        .typing-indicator.active { display: flex; }
        .typing-dot {
            width: 8px; height: 8px; background: var(--text-secondary);
            border-radius: 50%; animation: typing 1.4s infinite;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        .settings-btn {
            background: var(--bg-input); border: none; color: var(--text-secondary);
            padding: 10px 20px; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;
        }
        .settings-btn:hover { background: var(--border); color: var(--text-primary); }
        .connection-status {
            padding: 10px 15px; border-radius: 8px; margin-bottom: 20px; font-size: 0.9rem;
            display: flex; align-items: center; gap: 10px;
        }
        .connection-status.success { background: rgba(16, 185, 129, 0.1); color: var(--success); border: 1px solid rgba(16, 185, 129, 0.3); }
        .connection-status.warning { background: rgba(245, 158, 11, 0.1); color: #f59e0b; border: 1px solid rgba(245, 158, 11, 0.3); }
        .connection-status.error { background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-30px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes messageSlide { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes typing { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-10px); } }
        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .card { padding: 20px; }
            .message-content { max-width: 85%; }
            .settings-panel { width: 100%; right: -100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AI Interview Trainer</h1>
            <p>–ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—é —Å –ø–æ–º–æ—â—å—é –ò–ò</p>
            <div style="margin-top: 20px; padding: 10px; background: rgba(34, 211, 238, 0.1); border-radius: 10px; border: 1px solid rgba(34, 211, 238, 0.3);">
                <p style="color: var(--accent); font-size: 0.9rem;">üöÄ –í–µ—Ä—Å–∏—è 3.2.0</p>
            </div>
        </div>

        <div id="setupScreen" class="screen active">
            <div class="card">
                <div class="form-group">
                    <label for="vacancy">üìã –û–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏ *</label>
                    <textarea id="vacancy" rows="6" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –≤—ã –ø—Ä–µ—Ç–µ–Ω–¥—É–µ—Ç–µ..."></textarea>
                </div>
                <div class="form-group">
                    <label for="resume">üìÑ –í–∞—à–µ —Ä–µ–∑—é–º–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <textarea id="resume" rows="6" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à–µ —Ä–µ–∑—é–º–µ –∑–¥–µ—Å—å –¥–ª—è –±–æ–ª–µ–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏..."></textarea>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="btn" onclick="startInterview()">–ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É ‚Üí</button>
                    <button class="settings-btn" onclick="toggleSettings()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                </div>
            </div>
        </div>

        <div id="chatScreen" class="screen">
            <div class="chat-container">
                <div class="chat-header">
                    <h3>
                        <span class="status-dot"></span>
                        AI –ò–Ω—Ç–µ—Ä–≤—å—é–µ—Ä
                        <span class="model-badge" id="modelBadge">Gemini 2.0 Flash</span>
                    </h3>
                    <div>
                        <button class="settings-btn" onclick="toggleSettings()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                        <button class="btn-secondary btn" onclick="backToSetup()">‚Üê –ù–∞–∑–∞–¥</button>
                    </div>
                </div>
                <div class="chat-messages" id="chatMessages"></div>
                <div class="typing-indicator" id="typingIndicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <input type="text" class="chat-input" id="messageInput" 
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç..." onkeypress="handleKeyPress(event)">
                        <button class="send-btn" id="sendBtn" onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            <button class="close-settings" onclick="toggleSettings()">‚úï</button>
        </div>
        <div id="connectionStatus" class="connection-status"></div>
        <div class="form-group">
            <label for="llmProvider">ü§ñ –í—ã–±–µ—Ä–∏—Ç–µ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞</label>
            <select id="llmProvider" onchange="updateProviderSettings()">
                <option value="gemini">Google Gemini</option>
                <option value="openrouter">OpenRouter</option>
            </select>
        </div>
        <div class="form-group">
            <label for="apiMode">üîß –†–µ–∂–∏–º API</label>
            <select id="apiMode" onchange="updateApiModeDisplay(); saveSettings();">
                <option value="direct">–ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤</option>
                <option value="proxy">–ß–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä</option>
            </select>
        </div>
        <div class="form-group" id="proxyUrlGroup" style="display: none;">
            <label for="proxyUrl">üåê URL –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞</label>
            <input type="text" id="proxyUrl" placeholder="http://localhost:3000" onchange="saveSettings()">
        </div>

        <div class="provider-section" id="geminiSection">
            <h4>Google Gemini –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h4>
            <div class="form-group">
                <label for="geminiModel">–ú–æ–¥–µ–ª—å</label>
                <select id="geminiModel" onchange="saveSettings()">
                    <option value="gemini-2.0-flash-exp">Gemini 2.0 Flash Experimental</option>
                    <option value="gemini-1.5-pro-latest">Gemini 1.5 Pro Latest</option>
                    <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                    <option value="gemini-1.5-flash-latest">Gemini 1.5 Flash Latest</option>
                    <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                    <option value="gemini-1.5-flash-8b-latest">Gemini 1.5 Flash 8B Latest</option>
                    <option value="gemini-1.0-pro">Gemini 1.0 Pro</option>
                </select>
            </div>
            <div class="form-group">
                <label for="geminiApiKey">üîë API Key</label>
                <input type="password" id="geminiApiKey" placeholder="AIza..." onchange="saveSettings()">
            </div>
            <div class="model-info">üí° Gemini - –ø–µ—Ä–µ–¥–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –æ—Ç Google —Å –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é</div>
        </div>

        <div class="provider-section" id="openrouterSection" style="display: none;">
            <h4>OpenRouter –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h4>
            <div class="form-group">
                <label for="openrouterModel">–ú–æ–¥–µ–ª—å</label>
                <select id="openrouterModel" onchange="saveSettings()">
                    <option value="openai/gpt-4o">GPT-4o</option>
                    <option value="openai/gpt-4o-mini">GPT-4o Mini</option>
                    <option value="anthropic/claude-3.5-sonnet">Claude Sonnet 3.5</option>
                    <option value="x-ai/grok-2">Grok 2</option>
                </select>
            </div>
            <div class="form-group">
                <label for="openrouterApiKey">üîë API Key</label>
                <input type="password" id="openrouterApiKey" placeholder="sk-or-..." onchange="saveSettings()">
            </div>
            <div class="model-info">üí° OpenRouter –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–µ–π —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π API</div>
        </div>

        <div class="form-group">
            <label for="systemPrompt">üí¨ –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –ò–ò –∞–≥–µ–Ω—Ç–∞</label>
            <textarea id="systemPrompt" rows="10" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç..." 
                      onchange="saveSettings()">–¢—ã –æ–ø—ã—Ç–Ω—ã–π HR-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –∏ –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä. –ü—Ä–æ–≤–æ–¥–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –≤–∞–∫–∞–Ω—Å–∏–∏. –ó–∞–¥–∞–≤–∞–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –æ—Ü–µ–Ω–∏–≤–∞–π –æ—Ç–≤–µ—Ç—ã –∫–∞–Ω–¥–∏–¥–∞—Ç–∞, –¥–∞–≤–∞–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å. –ë—É–¥—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º, –Ω–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º.</textarea>
        </div>
        <button class="btn" onclick="saveSettings(); testConnection();">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    </div>

    <script>
        let conversationHistory = [];
        let currentVacancy = '';
        let currentResume = '';
        
        const CONFIG = {
            models: {
                'openai/gpt-4o': 'GPT-4o',
                'openai/gpt-4o-mini': 'GPT-4o Mini',
                'anthropic/claude-3.5-sonnet': 'Sonnet 3.5',
                'x-ai/grok-2': 'Grok 2'
            },
            geminiModels: {
                'gemini-2.0-flash-exp': 'Gemini 2.0 Flash',
                'gemini-1.5-pro-latest': 'Gemini 1.5 Pro',
                'gemini-1.5-pro': 'Gemini 1.5 Pro',
                'gemini-1.5-flash-latest': 'Gemini 1.5 Flash',
                'gemini-1.5-flash': 'Gemini 1.5 Flash',
                'gemini-1.5-flash-8b-latest': 'Gemini 1.5 Flash 8B',
                'gemini-1.0-pro': 'Gemini 1.0 Pro'
            },
            defaultValues: {
                llmProvider: 'gemini',
                openrouterModel: 'openai/gpt-4o',
                geminiModel: 'gemini-2.0-flash-exp',
                geminiApiKey: 'AIzaSyDIMqABFiNj0FudmRT9TjfYtvHLkRwgjgE',
                proxyUrl: 'http://localhost:3000',
                systemPrompt: '–¢—ã –æ–ø—ã—Ç–Ω—ã–π HR-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –∏ –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä. –ü—Ä–æ–≤–æ–¥–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –≤–∞–∫–∞–Ω—Å–∏–∏. –ó–∞–¥–∞–≤–∞–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –æ—Ü–µ–Ω–∏–≤–∞–π –æ—Ç–≤–µ—Ç—ã –∫–∞–Ω–¥–∏–¥–∞—Ç–∞, –¥–∞–≤–∞–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å. –ë—É–¥—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º, –Ω–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º.'
            }
        };

        window.onload = () => {
            loadSettings();
            updateProviderSettings();
            updateApiModeDisplay();
            testConnection();
        };

        const isClaudeEnvironment = () => 
            ['claude.ai', 'anthropic'].some(domain => window.location.hostname.includes(domain)) ||
            navigator.userAgent.includes('Claude') || window.location.protocol === 'file:';

        const getOptimalApiMode = () => isClaudeEnvironment() ? 'proxy' : 'direct';
        const getStorageValue = (key, defaultValue = '') => localStorage.getItem(key) || defaultValue;
        const setStorageValue = (key, value) => localStorage.setItem(key, value);
        const getElement = id => document.getElementById(id);

        const showNotification = text => {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 2000;
                background: linear-gradient(135deg, var(--success) 0%, var(--accent) 100%);
                color: white; padding: 15px 25px; border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); animation: slideIn 0.3s ease;
            `;
            notification.textContent = text;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        };

        function startInterview() {
            const vacancy = getElement('vacancy').value.trim();
            const resume = getElement('resume').value.trim();
            
            if (!vacancy) return alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏');
            
            currentVacancy = vacancy;
            currentResume = resume;
            conversationHistory = [];
            
            getElement('setupScreen').classList.remove('active');
            getElement('chatScreen').classList.add('active');
            getElement('chatMessages').innerHTML = '';
            updateModelBadge();
            
            setTimeout(() => {
                addMessage("–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –≤–∞—à –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä. –î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º –Ω–∞—à–µ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ. –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ–º–Ω–æ–≥–æ –æ —Å–µ–±–µ –∏ –ø–æ—á–µ–º—É –≤–∞—Å –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–ª–∞ —ç—Ç–∞ –≤–∞–∫–∞–Ω—Å–∏—è?", 'ai');
            }, 500);
        }

        function backToSetup() {
            getElement('chatScreen').classList.remove('active');
            getElement('setupScreen').classList.add('active');
        }

        function toggleSettings() {
            getElement('settingsPanel').classList.toggle('open');
        }

        function updateApiModeDisplay() {
            const apiMode = getElement('apiMode').value;
            getElement('proxyUrlGroup').style.display = apiMode === 'proxy' ? 'block' : 'none';
        }

        function updateProviderSettings() {
            const provider = getElement('llmProvider').value;
            const isGemini = provider === 'gemini';
            
            getElement('geminiSection').style.display = isGemini ? 'block' : 'none';
            getElement('openrouterSection').style.display = isGemini ? 'none' : 'block';
            
            updateModelBadge();
            updateApiModeDisplay();
        }

        function updateModelBadge() {
            const provider = getElement('llmProvider').value;
            const badge = getElement('modelBadge');
            
            if (provider === 'gemini') {
                const model = getElement('geminiModel').value;
                badge.textContent = CONFIG.geminiModels[model] || 'Gemini 2.0 Flash';
            } else {
                const model = getElement('openrouterModel').value;
                badge.textContent = CONFIG.models[model] || 'GPT-4o';
            }
        }

        function saveSettings() {
            const fields = ['llmProvider', 'apiMode', 'proxyUrl', 'systemPrompt', 
                           'openrouterApiKey', 'openrouterModel', 'geminiApiKey', 'geminiModel'];
            
            fields.forEach(field => {
                const element = getElement(field);
                if (element) setStorageValue(field, element.value);
            });
            
            updateModelBadge();
            updateApiModeDisplay();
            showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        }

        function loadSettings() {
            const settings = {
                llmProvider: getStorageValue('llmProvider', CONFIG.defaultValues.llmProvider),
                apiMode: getStorageValue('apiMode', getOptimalApiMode()),
                proxyUrl: getStorageValue('proxyUrl', CONFIG.defaultValues.proxyUrl),
                systemPrompt: getStorageValue('systemPrompt', CONFIG.defaultValues.systemPrompt),
                openrouterApiKey: getStorageValue('openrouterApiKey'),
                openrouterModel: getStorageValue('openrouterModel', CONFIG.defaultValues.openrouterModel),
                geminiApiKey: getStorageValue('geminiApiKey', CONFIG.defaultValues.geminiApiKey),
                geminiModel: getStorageValue('geminiModel', CONFIG.defaultValues.geminiModel)
            };
            
            Object.entries(settings).forEach(([key, value]) => {
                const element = getElement(key);
                if (element) element.value = value;
            });
        }

        function addMessage(text, sender) {
            const messagesContainer = getElement('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const time = new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${sender === 'ai' ? 'AI' : '–í—ã'}</div>
                <div class="message-content">
                    <div>${text}</div>
                    <div class="message-time">${time}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            conversationHistory.push({ role: sender === 'ai' ? 'assistant' : 'user', content: text });
        }

        async function sendMessage() {
            const input = getElement('messageInput');
            const message = input.value.trim();
            if (!message) return;
            
            getElement('sendBtn').disabled = true;
            addMessage(message, 'user');
            input.value = '';
            showTypingIndicator(true);
            
            try {
                const response = await callLLMAPI(message);
                showTypingIndicator(false);
                addMessage(response, 'ai');
            } catch (error) {
                showTypingIndicator(false);
                addMessage('–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ API.', 'ai');
                console.error('API Error:', error);
            }
            
            getElement('sendBtn').disabled = false;
        }

        async function callLLMAPI(userMessage, isTest = false) {
            const provider = getStorageValue('llmProvider', CONFIG.defaultValues.llmProvider);
            const apiKey = getStorageValue('geminiApiKey', CONFIG.defaultValues.geminiApiKey);
            const model = getStorageValue('geminiModel', CONFIG.defaultValues.geminiModel);
            
            if (isTest) {
                const
